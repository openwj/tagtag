---
title: 代码规范与最佳实践
description: Tagtag 项目的代码规范和最佳实践指南。
---

良好的代码规范是保证代码质量、提高开发效率、减少维护成本的重要手段。本文档总结了 Tagtag 项目的代码规范和最佳实践，包括 Java 后端和 TypeScript 前端的编码规范、命名约定和代码审查标准。

## 1. 通用原则

无论使用哪种编程语言，以下通用原则都应遵循：

### 1.1 代码可读性优先

- 代码是写给人看的，不是写给机器看的
- 保持代码简洁、清晰、易于理解
- 使用有意义的命名，避免缩写和隐晦的名称
- 适当添加注释，但不要过度注释

### 1.2 一致性

- 遵循项目已有的代码风格
- 保持缩进、换行、空格等格式一致
- 统一使用一种命名风格

### 1.3 模块化

- 将代码拆分为可复用的模块
- 每个模块职责单一
- 模块间依赖关系清晰

### 1.4 测试优先

- 编写可测试的代码
- 为核心功能编写单元测试
- 遵循测试驱动开发（TDD）原则

### 1.5 安全性

- 避免硬编码敏感信息
- 注意 SQL 注入、XSS 攻击等安全问题
- 遵循最小权限原则

## 2. Java 代码规范

Tagtag 后端使用 Java 语言开发，遵循以下代码规范：

### 2.1 命名约定

- **类名**：使用 PascalCase，例如 `UserService`、`PostController`
- **方法名**：使用 camelCase，例如 `getUserById`、`savePost`
- **变量名**：使用 camelCase，例如 `userName`、`pageSize`
- **常量名**：使用 UPPER_CASE_WITH_UNDERSCORES，例如 `MAX_PAGE_SIZE`、`DEFAULT_STATUS`
- **包名**：使用小写字母，例如 `dev.tagtag.common.util`
- **接口名**：使用 PascalCase，例如 `UserService`、`PostMapper`

### 2.2 代码格式

- **缩进**：使用 4 个空格进行缩进
- **换行**：每行不超过 120 个字符
- **空行**：在方法之间、代码块之间添加适当的空行
- **括号**：左括号 `{` 与语句同一行，右括号 `}` 单独一行
- **空格**：
  - 运算符前后添加空格，例如 `a = b + c`
  - 逗号、分号后添加空格，例如 `method(a, b, c)`
  - 括号内不添加空格，例如 `method(a, b)` 而非 `method( a, b )`

### 2.3 注释规范

- **类注释**：使用 Javadoc 注释，说明类的用途、作者、创建日期等
  ```java
  /**
   * 用户服务类，负责用户相关业务逻辑
   *
   * @author Tagtag Team
   * @since 2024-01-01
   */
  @Service
  public class UserService {
      // 类实现
  }
  ```

- **方法注释**：使用 Javadoc 注释，说明方法的用途、参数、返回值、异常等
  ```java
  /**
   * 根据用户 ID 获取用户信息
   *
   * @param userId 用户 ID
   * @return 用户信息
   * @throws BusinessException 如果用户不存在
   */
  public UserDTO getUserById(Long userId) {
      // 方法实现
  }
  ```

- **行注释**：使用 `//` 注释，说明复杂逻辑或特殊处理
  ```java
  // 处理特殊情况：当用户未设置头像时，使用默认头像
  if (user.getAvatar() == null) {
      user.setAvatar(DEFAULT_AVATAR);
  }
  ```

### 2.4 最佳实践

- **使用 Lombok 简化代码**：使用 `@Data`、`@NoArgsConstructor`、`@AllArgsConstructor` 等注解简化 POJO 类
- **避免魔法数字**：将常量定义为静态常量，例如 `private static final int MAX_RETRY = 3`
- **使用 Optional 处理 null**：避免直接使用 null，使用 Optional 包装可能为 null 的值
- **使用 try-with-resources 管理资源**：自动关闭资源，避免内存泄漏
- **遵循 SOLID 原则**：
  - 单一职责原则：一个类只负责一个功能
  - 开放封闭原则：对扩展开放，对修改封闭
  - 里氏替换原则：子类可以替换父类
  - 接口隔离原则：使用多个专门的接口，而不是一个总接口
  - 依赖倒置原则：依赖抽象，不依赖具体实现

### 2.5 Spring Boot 最佳实践

- **使用构造函数注入**：避免使用字段注入，提高可测试性
  ```java
  @Service
  @RequiredArgsConstructor
  public class UserServiceImpl implements UserService {
      private final UserMapper userMapper;
      private final RoleService roleService;
      // 方法实现
  }
  ```

- **使用 @RestController 替代 @Controller + @ResponseBody**：简化 REST 接口开发
- **使用 @ExceptionHandler 处理异常**：统一处理异常，提高代码可读性
- **使用 @Validated 进行参数校验**：自动校验请求参数，减少重复代码
- **使用 @Transactional 管理事务**：明确事务边界，确保数据一致性

## 3. TypeScript 代码规范

Tagtag 前端使用 TypeScript 语言开发，遵循以下代码规范：

### 3.1 命名约定

- **组件名**：使用 PascalCase，例如 `PostList`、`FormModal`
- **变量名**：使用 camelCase，例如 `userName`、`isLoading`
- **函数名**：使用 camelCase，例如 `getUserInfo`、`handleSubmit`
- **常量名**：使用 UPPER_CASE_WITH_UNDERSCORES，例如 `MAX_PAGE_SIZE`、`API_BASE_URL`
- **类型名**：使用 PascalCase，例如 `UserDTO`、`PostQuery`
- **接口名**：使用 PascalCase，例如 `UserService`、`PostApi`

### 3.2 代码格式

- **缩进**：使用 2 个空格进行缩进
- **换行**：每行不超过 120 个字符
- **空行**：在函数之间、代码块之间添加适当的空行
- **括号**：左括号 `{` 与语句同一行，右括号 `}` 单独一行
- **空格**：
  - 运算符前后添加空格，例如 `a = b + c`
  - 逗号、分号后添加空格，例如 `method(a, b, c)`
  - 括号内不添加空格，例如 `method(a, b)` 而非 `method( a, b )`

### 3.3 注释规范

- **组件注释**：使用 JSDoc 注释，说明组件的用途、属性、事件等
  ```typescript
  /**
   * 文章列表组件，展示文章列表并提供筛选、排序功能
   *
   * @component
   * @param {Object} props - 组件属性
   * @param {Function} onEdit - 编辑文章回调函数
   * @param {Function} onDelete - 删除文章回调函数
   */
  export default defineComponent({
      // 组件实现
  });
  ```

- **函数注释**：使用 JSDoc 注释，说明函数的用途、参数、返回值等
  ```typescript
  /**
   * 获取文章列表
   *
   * @param {PostQuery} params - 查询参数
   * @returns {Promise<PageResult<PostDTO>>} 文章列表
   */
  export function getPostList(params: PostQuery): Promise<PageResult<PostDTO>> {
      // 函数实现
  }
  ```

- **行注释**：使用 `//` 注释，说明复杂逻辑或特殊处理
  ```typescript
  // 处理特殊情况：当文章状态为 0 时，显示为草稿
  const statusText = status === 1 ? '已发布' : '草稿';
  ```

### 3.4 最佳实践

- **使用 TypeScript 严格模式**：启用 `strict: true` 配置，提高类型安全性
- **避免 any 类型**：尽量使用具体类型，提高代码可靠性
- **使用接口定义数据结构**：明确数据类型，提高代码可读性
- **使用 const 替代 let**：除非需要重新赋值，否则使用 const
- **使用箭头函数**：简化函数定义，避免 this 指向问题
- **使用解构赋值**：简化变量赋值，提高代码可读性
- **使用模板字符串**：简化字符串拼接

### 3.5 Vue 3 最佳实践

- **使用 Composition API**：利用 setup 语法糖，提高代码组织性和复用性
  ```vue
  <script setup lang="ts">
  import { ref, computed } from 'vue';
  
  const count = ref(0);
  const doubleCount = computed(() => count.value * 2);
  
  function increment() {
      count.value++;
  }
  </script>
  ```

- **使用 defineProps 和 defineEmits**：简化组件属性和事件定义
  ```typescript
  const props = defineProps<{
      title: string;
      visible: boolean;
  }>();
  
  const emit = defineEmits<{
      (e: 'close'): void;
      (e: 'save', data: FormData): void;
  }>();
  ```

- **使用 watchEffect 替代 watch**：简化响应式数据监听
- **使用 provide/inject 进行组件间通信**：避免 props 层层传递
- **使用 Teleport 处理模态框**：优化模态框定位和样式
- **使用 Suspense 处理异步组件**：提供加载状态和错误处理

## 4. 命名约定

### 4.1 包/模块命名

- **Java 包名**：使用小写字母，例如 `dev.tagtag.common.util`
- **TypeScript 模块名**：使用小写字母，例如 `@/api/modules/system/post`
- **目录名**：使用 kebab-case，例如 `user-management`、`post-list`

### 4.2 类/接口命名

- **Java 类名**：使用 PascalCase，例如 `UserService`、`PostController`
- **TypeScript 类型名**：使用 PascalCase，例如 `UserDTO`、`PostQuery`
- **接口名**：使用 PascalCase，例如 `UserRepository`、`PostService`

### 4.3 方法命名

- **获取数据**：使用 `get` 或 `find` 前缀，例如 `getUserById`、`findPosts`
- **保存数据**：使用 `save` 或 `create` 前缀，例如 `saveUser`、`createPost`
- **更新数据**：使用 `update` 前缀，例如 `updateUser`、`updatePost`
- **删除数据**：使用 `delete` 前缀，例如 `deleteUser`、`deletePost`
- **查询列表**：使用 `list` 或 `page` 前缀，例如 `listUsers`、`pagePosts`
- **处理事件**：使用 `handle` 前缀，例如 `handleSubmit`、`handleDelete`

### 4.4 变量命名

- **布尔变量**：使用 `is` 或 `has` 前缀，例如 `isLoading`、`hasPermission`
- **数组变量**：使用复数形式，例如 `users`、`posts`
- **集合变量**：使用具体集合类型，例如 `userList`、`postMap`
- **常量变量**：使用 UPPER_CASE_WITH_UNDERSCORES，例如 `MAX_PAGE_SIZE`、`DEFAULT_AVATAR`

## 5. 代码审查标准

代码审查是保证代码质量的重要环节，以下是 Tagtag 项目的代码审查标准：

### 5.1 审查内容

- **功能正确性**：代码是否实现了预期功能
- **代码规范**：是否遵循项目的代码规范
- **代码可读性**：代码是否易于理解和维护
- **性能**：是否存在性能问题，例如循环嵌套过深、不必要的计算等
- **安全性**：是否存在安全漏洞，例如 SQL 注入、XSS 攻击等
- **测试覆盖率**：是否为核心功能编写了测试用例
- **依赖关系**：模块间依赖关系是否清晰，是否存在循环依赖

### 5.2 审查流程

1. **提交代码前**：
   - 运行本地测试，确保所有测试通过
   - 运行代码格式化工具，例如 Prettier
   - 运行静态代码分析工具，例如 ESLint、SonarQube

2. **提交代码后**：
   - 创建 Pull Request (PR)
   - 指定至少一位 reviewer
   - 填写清晰的 PR 描述，包括功能、修改内容、测试情况等

3. **Reviewer 审查**：
   - 检查代码是否符合规范
   - 提出修改建议
   - 批准或拒绝 PR

4. **修改代码**：
   - 根据 reviewer 的建议修改代码
   - 重新运行测试和代码分析
   - 提交修改

5. **合并代码**：
   - 所有 reviewer 批准后，合并 PR
   - 删除临时分支

### 5.3 审查标准

- **必须修复的问题**：
  - 语法错误
  - 逻辑错误
  - 安全漏洞
  - 性能问题
  - 违反基本设计原则

- **建议修复的问题**：
  - 代码可读性问题
  - 命名不规范
  - 注释不足
  - 重复代码
  - 可以优化的代码

### 5.4 审查技巧

- **专注于代码逻辑**：不要纠结于排版等细节问题，使用自动化工具解决
- **提出具体建议**：不要只说 "这个地方不好"，要说明具体问题和改进方案
- **保持建设性**：使用积极的语言，避免指责
- **尊重作者**：理解作者的设计思路，不要轻易否定
- **学习他人代码**：从审查中学习好的设计和实现

## 6. Git 最佳实践

### 6.1 分支管理

- **主分支 (main)**：稳定的生产分支，只接收合并请求
- **开发分支 (develop)**：开发分支，包含最新的开发代码
- **功能分支 (feature/xxx)**：开发新功能的分支，从 develop 分支创建
- **修复分支 (fix/xxx)**：修复 bug 的分支，从 main 分支创建
- **发布分支 (release/xxx)**：准备发布的分支，从 develop 分支创建

### 6.2 提交规范

- **提交信息清晰**：使用简洁明了的提交信息，说明修改内容
- **提交信息格式**：
  ```
  <type>(<scope>): <subject>
  
  <body>
  
  <footer>
  ```

  - **type**：提交类型，包括 feat(新功能)、fix(修复bug)、docs(文档)、style(样式)、refactor(重构)、test(测试)、chore(构建)等
  - **scope**：修改范围，例如 user、post、auth 等
  - **subject**：简短的提交描述，不超过 50 个字符
  - **body**：详细的提交描述，说明修改的原因和内容
  - **footer**：包含 breaking changes 或 issue 链接

- **示例**：
  ```
  feat(user): 新增用户头像上传功能
  
  1. 添加头像上传接口
  2. 实现头像裁剪功能
  3. 更新用户信息页面
  
  Closes #123
  ```

### 6.3 提交频率

- **频繁提交**：每次提交一个小功能或修复一个小 bug
- **避免大提交**：不要一次提交大量代码，难以审查和回滚
- **保持提交原子性**：每个提交只包含一个逻辑变更

## 7. 总结

良好的代码规范和最佳实践是保证项目质量的重要基础。通过遵循本文档的规范和建议，我们可以：

- 提高代码的可读性和可维护性
- 减少 bug 和安全漏洞
- 提高开发效率和协作效率
- 降低项目的长期维护成本

希望所有开发者都能严格遵循这些规范和最佳实践，共同维护一个高质量的代码库。
