---
title: 实战教程：开发 CRUD 功能
description: 从零开始开发一个完整的增删改查功能模块。
---

# 实战教程：开发 CRUD 功能

本教程将以开发一个简单的 **“文章管理 (Post)”** 功能为例，带您完整体验 Tagtag 的前后端开发流程。

我们将实现以下功能：
1.  文章列表的分页查询。
2.  新增文章。
3.  编辑文章。
4.  删除文章。

---

## 第一步：后端开发 (Backend)

### 1. 数据库设计

首先，在数据库中创建 `sys_post` 表。

```sql
CREATE TABLE `sys_post` (
  `id` bigint(20) NOT NULL AUTO_INCREMENT COMMENT '主键',
  `title` varchar(100) NOT NULL COMMENT '文章标题',
  `content` text COMMENT '文章内容',
  `status` tinyint(4) DEFAULT 1 COMMENT '状态: 1-发布, 0-草稿',
  `create_time` datetime DEFAULT NULL COMMENT '创建时间',
  `update_time` datetime DEFAULT NULL COMMENT '更新时间',
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='文章表';
```

### 2. 定义契约 (Contract)

在 `tagtag-contract` 模块中定义 DTO (Data Transfer Object)。建议新建 `PostDTO.java` 和 `PostQuery.java`。

**PostDTO.java (用于新增/修改)**
```java
package dev.tagtag.contract.system.dto;

import lombok.Data;
import jakarta.validation.constraints.NotBlank;

@Data
public class PostDTO {
    private Long id;

    @NotBlank(message = "标题不能为空")
    private String title;

    private String content;

    private Integer status;
}
```

**PostQuery.java (用于查询)**
```java
package dev.tagtag.contract.system.query;

import dev.tagtag.common.model.PageQuery; // 继承基础分页类
import lombok.Data;
import lombok.EqualsAndHashCode;

@Data
@EqualsAndHashCode(callSuper = true)
public class PostQuery extends PageQuery {
    private String title;
    private Integer status;
}
```

### 3. 持久层实现 (Mapper & Entity)

在 `tagtag-module-system` 模块中创建实体类和 Mapper。

**PostEntity.java**
```java
package dev.tagtag.module.system.entity;

import com.baomidou.mybatisplus.annotation.TableName;
import dev.tagtag.framework.mybatis.entity.BaseEntity; // 包含 id, createTime, updateTime
import lombok.Data;
import lombok.EqualsAndHashCode;

@Data
@EqualsAndHashCode(callSuper = true)
@TableName("sys_post")
public class PostEntity extends BaseEntity {
    private String title;
    private String content;
    private Integer status;
}
```

**PostMapper.java**
```java
package dev.tagtag.module.system.mapper;

import com.baomidou.mybatisplus.core.mapper.BaseMapper;
import dev.tagtag.module.system.entity.PostEntity;
import org.apache.ibatis.annotations.Mapper;

@Mapper
public interface PostMapper extends BaseMapper<PostEntity> {
}
```

### 4. 业务层实现 (Service)

**PostService.java**
```java
public interface PostService {
    PageResult<PostEntity> page(PostQuery query);
    void save(PostDTO dto);
    void update(PostDTO dto);
    void delete(List<Long> ids);
}
```

**PostServiceImpl.java**
```java
@Service
@RequiredArgsConstructor
public class PostServiceImpl implements PostService {
    private final PostMapper postMapper;

    @Override
    public PageResult<PostEntity> page(PostQuery query) {
        // 使用 MyBatis Plus 的分页插件
        Page<PostEntity> page = new Page<>(query.getPage(), query.getSize());
        LambdaQueryWrapper<PostEntity> wrapper = new LambdaQueryWrapper<PostEntity>()
                .like(StringUtils.isNotBlank(query.getTitle()), PostEntity::getTitle, query.getTitle())
                .eq(query.getStatus() != null, PostEntity::getStatus, query.getStatus())
                .orderByDesc(PostEntity::getCreateTime);
        
        return PageResult.of(postMapper.selectPage(page, wrapper));
    }

    @Override
    public void save(PostDTO dto) {
        PostEntity entity = BeanUtil.copyProperties(dto, PostEntity.class);
        postMapper.insert(entity);
    }

    // update 和 delete 实现类似...
}
```

### 5. 控制层实现 (Controller)

```java
@RestController
@RequestMapping("/posts")
@Tag(name = "文章管理")
public class PostController {
    
    @Resource
    private PostService postService;

    @GetMapping
    @Operation(summary = "分页查询")
    @PreAuthorize("@ss.hasPermission('sys:post:query')")
    public Result<PageResult<PostEntity>> page(PostQuery query) {
        return Result.success(postService.page(query));
    }

    @PostMapping
    @Operation(summary = "新增文章")
    @OperationLog(module = "文章管理", name = "新增文章", type = OperationType.ADD)
    @PreAuthorize("@ss.hasPermission('sys:post:add')")
    public Result<Void> save(@RequestBody @Valid PostDTO dto) {
        postService.save(dto);
        return Result.success();
    }
    
    // 其他方法...
}
```

---

## 第二步：前端开发 (Frontend)

### 1. 定义 API

在 `tagtag-ui/apps/tagtag/src/api/modules/system/post.ts` 中定义请求。

```typescript
import { request } from '@/api/request';

export function getPostPage(params: any) {
  return request.get({ url: '/posts', params });
}

export function addPost(data: any) {
  return request.post({ url: '/posts', data });
}

export function updatePost(data: any) {
  return request.put({ url: '/posts', data });
}

export function deletePost(ids: number[]) {
  return request.delete({ url: '/posts', data: ids });
}
```

### 2. 创建列表页面

创建 `tagtag-ui/apps/tagtag/src/views/modules/system/post/index.vue`。

```vue
<script setup lang="ts">
import { useTable } from '@vben/plugins/vxe-table';
import { getPostPage, deletePost } from '@/api/modules/system/post';

const [Grid, gridApi] = useTable({
  api: getPostPage,
  columns: [
    { type: 'checkbox', width: 50 },
    { field: 'title', title: '标题' },
    { field: 'status', title: '状态', slots: { default: 'status' } },
    { field: 'createTime', title: '创建时间' },
    { title: '操作', slots: { default: 'action' }, width: 150 },
  ],
  formConfig: {
    items: [
      { field: 'title', label: '标题', component: 'Input' }
    ]
  },
  toolbarConfig: {
    buttons: [
      { code: 'add', name: '新增', status: 'primary' },
      { code: 'delete', name: '删除', status: 'danger' }
    ]
  }
});

function handleAdd() {
  // 打开弹窗逻辑...
}
</script>

<template>
  <Grid>
    <template #status="{ row }">
      <Tag :color="row.status === 1 ? 'green' : 'red'">
        {{ row.status === 1 ? '已发布' : '草稿' }}
      </Tag>
    </template>
    <template #action="{ row }">
      <Button type="link" @click="handleEdit(row)">编辑</Button>
      <Button type="link" danger @click="handleDelete(row)">删除</Button>
    </template>
  </Grid>
</template>
```

### 3. 配置菜单

1.  启动项目，登录管理员账号。
2.  进入 **系统管理 -> 菜单管理**。
3.  新增菜单 “文章管理”，路由地址填 `/system/post`，组件路径填 `modules/system/post/index.vue`。
4.  刷新页面，即可看到新功能。

---

## 总结

通过以上步骤，您已经成功开发了一个包含前后端交互的完整 CRUD 模块。Tagtag 的模块化设计让这一切变得清晰且规范。
