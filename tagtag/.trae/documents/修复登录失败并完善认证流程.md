## 问题分析
- 登录实现位于 `tagtag-module/tagtag-module-auth/src/main/java/dev/tagtag/module/auth/service/impl/AuthServiceImpl.java:44` 的 `login(String username, String password)`。
- 代码逻辑：分页查找用户 → 取首条 → 再按 ID 查询详情（取到 `password`）→ 使用 `PasswordEncoder` 校验（支持 `$2a/$2b/$2y` 前缀）。
- 密码加密器在 `tagtag-framework/src/main/java/dev/tagtag/framework/config/SecurityConfig.java:61`，Bean 为 `BCryptPasswordEncoder`，与种子数据一致。
- 数据种子在 `tagtag-module/tagtag-module-iam/src/main/resources/db/migration/iam/V2__seed.sql:3-6` 明确“默认密码：password”，其哈希 `$2a$10$DowSDzAgY9jw.CElImZfROo16n6W8f9lZ5nV9iFz8LRKkKxsMgjs6` 是标准 BCrypt。
- 可能原因：
  1) 实际运行环境的数据源未指向包含种子数据的库（`application-dev.yml` 指向 `jdbc:mysql://localhost:3306/tagtag-v2`）；
  2) Flyway 未执行或执行到其它 schema，导致 `admin` 记录不存在或密码不同；
  3) 登录链路里分页查询使用 `LIKE`，理论上能命中，但两次查询带来不确定性；
  4) 不是密码阶段报错，而是后续角色/菜单查询异常，但用户反馈更像“密码错误”。

## 验证步骤
- 核对数据源与迁移：
  - 查看 `tagtag-start/src/main/resources/application-dev.yml:8-11` 的数据库连接是否是你正在使用的库；
  - 在该库中确认 `iam_user` 存在 `admin`，`password` 字段值为提供的哈希，`status=1`、`deleted=0`。
- 逻辑确认：
  - 代码确实会在 `stored.startsWith("$2a$")` 分支调用 `passwordEncoder.matches(password, stored)`，理论上应通过；
- 若核对无误仍失败，优先排除链路不确定性：改为“按用户名直接查详情并校验”，避免分页+二次查询的绕行。

## 实施改动
- 新增按用户名精确查询：
  - 在 `tagtag-module/tagtag-module-iam/src/main/resources/mapper/iam/UserMapper.xml` 增加 `selectByUsername`，返回包含 `password` 的完整列。
  - 在 `tagtag-module/tagtag-module-iam/src/main/java/dev/tagtag/module/iam/mapper/UserMapper.java` 增加对应方法签名。
  - 在 `tagtag-module/tagtag-module-iam/src/main/java/dev/tagtag/module/iam/service/UserService.java` 与 `impl/UserServiceImpl.java` 增加 `getByUsername(String username)`，返回 `UserDTO`（含 `password`）。
  - 在契约层 `tagtag-contract/tagtag-contract-iam/src/main/java/dev/tagtag/contract/iam/api/UserApi.java` 增加 `Result<UserDTO> getUserByUsername(String username)`；并在 `tagtag-module/tagtag-module-iam/src/main/java/dev/tagtag/module/iam/api/impl/UserApiImpl.java` 实现该方法。
- 精简登录：
  - 在 `AuthServiceImpl.login` 中直接调用 `userApi.getUserByUsername(username)` 获取完整用户，使用 `passwordEncoder.matches` 校验；移除分页与二次查询。
  - 保留 `$2a/$2b/$2y` 前缀判断分支，同时兼容明文（用于开发环境）。
- 代码要求：所有新增/修改的函数添加函数级注释。

## 验证与回归
- 启动开发环境，调用 `POST /api/auth/login`，请求体：`{"username":"admin","password":"password"}` 应得到 200，返回 `accessToken` 与 `refreshToken`。
- 用返回的 `accessToken` 访问受保护接口，确认鉴权通过。
- 回归检查：
  - 其他用户创建/更新流程不受影响；
  - 不在对外响应中暴露 `password` 字段；
  - Flyway 仍按 `classpath:db/migration` 正常迁移。

## 备用方案
- 如不希望扩展契约接口，可在 `AuthServiceImpl` 中临时引入一个只读的 `UserService` 以直接查用户名；但为保持分层解耦，推荐扩展契约。