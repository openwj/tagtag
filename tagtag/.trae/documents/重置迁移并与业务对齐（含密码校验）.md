## 目标
- 删除现有 V1/V2，重新生成与实际业务一致的初始化与种子脚本。
- 同步实体与服务逻辑，特别是 `iam_user` 表需要 `password` 字段，并在登录时进行密码校验（BCrypt）。

## 数据库脚本（新生成）
1. 新 V1__init.sql（一次性创建全部表与索引）
- 表：
  - `iam_user`：`id`、`username`（唯一）、`password`（BCrypt）、`nickname`、`email`、`mobile`、`gender`、`status`、`create_time`、`update_time`、`create_by`、`update_by`、`deleted`；索引：`uk_username`、`idx_status` 等
  - `iam_role`：`id`、`code`（唯一）、`name`、`status`、审计字段与索引
  - `iam_menu`：采用你提供的 `sys_menu` 结构（目录/菜单/按钮全字段），并用 `uk_menu_code` 唯一索引
  - `iam_user_role`：`user_id`、`role_id` 联合唯一与索引
  - `iam_role_menu`：`role_id`、`menu_id` 联合唯一与索引
  - `iam_dept`：`id`、`name`、`parent_id`、`sort`、`status`、审计字段与索引
- 约束：使用 `utf8mb4`、`InnoDB`，必要联合唯一与常用索引（parent_id、status、sort、menu_type 等）

2. 新 V2__seed.sql（基础数据）
- 插入 `admin` 用户（`username=admin`，`password` 写入 BCrypt 哈希，如 `$2a$10$...`）
- 插入 `ADMIN` 角色
- 插入基础菜单（含按钮：`user:create`、`user:update`、`user:delete`、`user:assignRole`）
- 绑定关系：`admin`→`ADMIN`；`ADMIN`→按钮型菜单集合

## 代码同步
1. 实体与 Mapper
- `User` 实体：增加/确认 `password` 字段（String），与 `iam_user.password` 对应；其他字段与 V1 保持一致
- `UserMapper.xml`：如有显式列映射，补充 `password` 字段与驼峰映射（`create_time AS createTime` 等）
- 已完成的菜单改造（`Menu`/`MenuMapper`/`MenuService`/`MenuController`）保持不变

2. 登录与认证
- `AuthServiceImpl#login`：
  - 通过 `UserApi` 查询用户信息（含 `password`）
  - 使用 `PasswordEncoder`（BCrypt）校验明文密码与哈希
  - 成功后聚合角色与按钮型菜单 `menu_code` 作为令牌 `perms`，生成访问/刷新令牌
- `SecurityConfig`：已提供 `PasswordEncoder` Bean（`BCryptPasswordEncoder`），继续复用

3. 函数级注释
- 为变更的服务方法（登录校验、用户查询、菜单/角色分配）补充中文函数级注释，说明用途、参数与返回

## 开发环境执行
- 清库重建（你已同意）：删除现有库或 `flyway_schema_history` 与半成品表
- 重新启动：Flyway 按新的 `V1 → V2` 初始化，与代码完全一致

## 验证
- 登录：`POST /api/auth/login`（校验密码）返回令牌
- 角色菜单：`GET /iam/roles/{id}/menus` 返回按钮型菜单集合
- 菜单管理：`POST /iam/menus/page`、`GET /iam/menus/{id}`、`POST/PUT/DELETE /iam/menus`
- 授权：带令牌访问含 `@PreAuthorize("hasAuthority('PERM_user:create')")` 的接口，返回 200；未授权 403；未认证 401

## 注意
- 新项目场景下直接重置 V1/V2 安全；生产环境请使用增量迁移而非改历史
- `jwt.secret` 用环境变量注入；不得写入明文密码，统一使用 BCrypt 存储；必要时提供一个临时的 admin 初始密码并在首次登录后提示修改

我将据此删除旧 V1/V2、生成新脚本并同步实体与登录校验，然后进行构建与启动验证。