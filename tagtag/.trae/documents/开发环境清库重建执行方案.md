## 目标
- 彻底清理当前开发库的迁移历史与半成品表，确保 Flyway 从最新的 V1/V2 重新初始化，恢复正常启动与联调。

## 前置检查
- 配置只保留 OSS 支持的键：
  - `spring.flyway.enabled: true`
  - `spring.flyway.locations: classpath:db/migration`
  - `spring.flyway.baseline-on-migrate: false`
  - `spring.flyway.clean-disabled: false`
- 移除不支持或已弃用键：
  - 删除任何 `spring.flyway.errorOverrides`（OSS不支持）
  - 删除 `spring.flyway.clean-on-validation-error`（10.18弃用、11.0移除）

## 方案 A：直接清库重建（推荐）
1. 备份数据（如已有重要数据）。
2. 使用 MySQL 客户端或管理工具执行：
```
-- 确认当前开发库名（示例假设为 tagtag-v2，如你的配置为 tagtag 则替换之）
DROP DATABASE IF EXISTS `tagtag-v2`;
CREATE DATABASE `tagtag-v2` CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
```
3. 启动应用（dev）：
- 打包：`mvn -DskipTests -pl tagtag-start -am package`
- 运行：`java -jar tagtag-start/target/tagtag-start-1.0.0.jar`
4. 观察日志：应依次执行 `V1__init.sql` 与 `V2__seed.sql`，应用启动成功。

## 方案 B：仅清理迁移历史与半成品表（替代方案）
1. 在当前库中执行：
```
DROP TABLE IF EXISTS flyway_schema_history;
-- 清理可能半创建的表（按需）：
DROP TABLE IF EXISTS iam_menu, iam_role_menu, iam_user, iam_role, iam_user_role, iam_dept;
```
2. 重启应用，Flyway 将从 V1 重建。

## 验证与联调
- 菜单接口：
  - 分页：`POST /iam/menus/page`
  - 详情：`GET /iam/menus/{id}`
  - 创建/更新/删除：`POST/PUT/DELETE /iam/menus`
- 角色菜单：
  - 查询：`GET /iam/roles/{id}/menus`
  - 分配：`POST /iam/roles/{id}/menus`
- 认证与授权：
  - 登录 `POST /api/auth/login` 获取令牌
  - 携带令牌访问带 `@PreAuthorize("hasAuthority('PERM_user:create')")` 的接口返回 200；无权限 403；未认证 401

## 备注
- 开发环境优先使用方案 A，最干净、最省事。
- 若后续仍遇到历史不一致，可临时添加 `spring.flyway.out-of-order: true` 进行补跑（仅用于排障），修复后移除。

请确认按方案 A 执行清库，我将据此推进后续验证与联调说明。